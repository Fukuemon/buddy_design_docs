<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="679px" preserveAspectRatio="none" style="width:1415px;height:679px;" version="1.1" viewBox="0 0 1415 679" width="1415px" zoomAndPan="magnify"><defs><filter height="300%" id="f2yujs7crhd66" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="39" x2="39" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="120" x2="120" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="422.5" x2="422.5" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="576.5" x2="576.5" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="704.5" x2="704.5" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="810" x2="810" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="882" x2="882" y1="86.2969" y2="592.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1052" x2="1052" y1="86.2969" y2="592.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="8" y="82.9951">ユーザー</text><ellipse cx="39" cy="13" fill="#FEFECE" filter="url(#f2yujs7crhd66)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M39,21 L39,48 M26,29 L52,29 M39,48 L26,63 M39,48 L52,63 " fill="none" filter="url(#f2yujs7crhd66)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="8" y="604.417">ユーザー</text><ellipse cx="39" cy="617.7188" fill="#FEFECE" filter="url(#f2yujs7crhd66)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M39,625.7188 L39,652.7188 M26,633.7188 L52,633.7188 M39,652.7188 L26,667.7188 M39,652.7188 L52,667.7188 " fill="none" filter="url(#f2yujs7crhd66)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="80" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="87" y="70.9951">Frontend</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="80" y="591.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="87" y="611.417">Frontend</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="373.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="380.5" y="70.9951">APIGateway</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="373.5" y="591.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="380.5" y="611.417">APIGateway</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="540.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="547.5" y="70.9951">Lambda</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="540.5" y="591.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="547.5" y="611.417">Lambda</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="668.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="675.5" y="70.9951">Cognito</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="668.5" y="591.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="675.5" y="611.417">Cognito</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="788" y="82.9951">Redis</text><path d="M792.5,34 C792.5,24 810.5,24 810.5,24 C810.5,24 828.5,24 828.5,34 L828.5,60 C828.5,70 810.5,70 810.5,70 C810.5,70 792.5,70 792.5,60 L792.5,34 " fill="#FEFECE" filter="url(#f2yujs7crhd66)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M792.5,34 C792.5,44 810.5,44 810.5,44 C810.5,44 828.5,44 828.5,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="788" y="604.417">Redis</text><path d="M792.5,617.7188 C792.5,607.7188 810.5,607.7188 810.5,607.7188 C810.5,607.7188 828.5,607.7188 828.5,617.7188 L828.5,643.7188 C828.5,653.7188 810.5,653.7188 810.5,653.7188 C810.5,653.7188 792.5,653.7188 792.5,643.7188 L792.5,617.7188 " fill="#FEFECE" filter="url(#f2yujs7crhd66)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M792.5,617.7188 C792.5,627.7188 810.5,627.7188 810.5,627.7188 C810.5,627.7188 828.5,627.7188 828.5,617.7188 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="843" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="850" y="70.9951">Backend</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="843" y="591.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="850" y="611.417">Backend</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="1033" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="1040" y="70.9951">DB</text><rect fill="#FEFECE" filter="url(#f2yujs7crhd66)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="1033" y="591.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="1040" y="611.417">DB</text><polygon fill="#A80036" points="108.5,113.4297,118.5,117.4297,108.5,121.4297,112.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="39" x2="114.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="46" y="112.3638">Action</text><polygon fill="#A80036" points="410.5,142.5625,420.5,146.5625,410.5,150.5625,414.5,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="120.5" x2="416.5" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="127.5" y="141.4966">Get: /users -header: {sessionId: SessionID}</text><polygon fill="#A80036" points="564.5,171.6953,574.5,175.6953,564.5,179.6953,568.5,175.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="422.5" x2="570.5" y1="175.6953" y2="175.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="429.5" y="170.6294">Lambda Authorizer</text><polygon fill="#A80036" points="798.5,200.8281,808.5,204.8281,798.5,208.8281,802.5,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="576.5" x2="804.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="583.5" y="199.7622">SessionIDを元にaccessToken取得</text><polygon fill="#A80036" points="587.5,229.9609,577.5,233.9609,587.5,237.9609,583.5,233.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="581.5" x2="809.5" y1="233.9609" y2="233.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="593.5" y="228.895">accessToken</text><polygon fill="#A80036" points="692.5,271.6602,702.5,275.6602,692.5,279.6602,696.5,275.6602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="576.5" x2="698.5" y1="275.6602" y2="275.6602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="583.5" y="270.5942">Token検証</text><path d="M709,246.9609 L709,286.9609 L1084,286.9609 L1084,256.9609 L1074,246.9609 L709,246.9609 " fill="#FBFB77" filter="url(#f2yujs7crhd66)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1074,246.9609 L1074,256.9609 L1084,256.9609 L1074,246.9609 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="715" y="264.0278">トークンの検証を行う</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="715" y="279.1606">成功時、Backendのエンドポイントへのアクセスを許可する</text><polygon fill="#A80036" points="587.5,313.3594,577.5,317.3594,587.5,321.3594,583.5,317.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="581.5" x2="703.5" y1="317.3594" y2="317.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="593.5" y="312.2935">トークン検証結果</text><polygon fill="#A80036" points="433.5,342.4922,423.5,346.4922,433.5,350.4922,429.5,346.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="427.5" x2="575.5" y1="346.4922" y2="346.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="439.5" y="341.4263">トークン検証結果返却</text><polygon fill="#A80036" points="870.5,371.625,880.5,375.625,870.5,379.625,874.5,375.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="422.5" x2="876.5" y1="375.625" y2="375.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="429.5" y="370.5591">（成功時）Get: /users</text><polygon fill="#A80036" points="1040.5,400.7578,1050.5,404.7578,1040.5,408.7578,1044.5,404.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="882.5" x2="1046.5" y1="404.7578" y2="404.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="889.5" y="399.6919">ユーザー情報取得</text><polygon fill="#A80036" points="893.5,414.7578,883.5,418.7578,893.5,422.7578,889.5,418.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="887.5" x2="1051.5" y1="418.7578" y2="418.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="882.5" x2="924.5" y1="453.957" y2="453.957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="924.5" x2="924.5" y1="453.957" y2="466.957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="883.5" x2="924.5" y1="466.957" y2="466.957"/><polygon fill="#A80036" points="893.5,462.957,883.5,466.957,893.5,470.957,889.5,466.957" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="889.5" y="448.8911">ユーザーの権限情報を確認</text><path d="M1057,431.7578 L1057,471.7578 L1403,471.7578 L1403,441.7578 L1393,431.7578 L1057,431.7578 " fill="#FBFB77" filter="url(#f2yujs7crhd66)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1393,431.7578 L1393,441.7578 L1403,441.7578 L1393,431.7578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="325" x="1063" y="448.8247">バックエンドでは、リクエストから権限情報を確認する</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="1063" y="463.9575">成功時、処理を実行し、レスポンスを返す</text><polygon fill="#A80036" points="1040.5,498.1563,1050.5,502.1563,1040.5,506.1563,1044.5,502.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="882.5" x2="1046.5" y1="502.1563" y2="502.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="889.5" y="497.0903">リソース取得</text><polygon fill="#A80036" points="893.5,512.1563,883.5,516.1563,893.5,520.1563,889.5,516.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="887.5" x2="1051.5" y1="516.1563" y2="516.1563"/><polygon fill="#A80036" points="433.5,541.2891,423.5,545.2891,433.5,549.2891,429.5,545.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="427.5" x2="881.5" y1="545.2891" y2="545.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="439.5" y="540.2231">Response"200":{"message": ok}</text><polygon fill="#A80036" points="131.5,570.4219,121.5,574.4219,131.5,578.4219,127.5,574.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="125.5" x2="421.5" y1="574.4219" y2="574.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="137.5" y="569.356">Response"200":{"message": ok}</text><!--MD5=[4500c4e2a853107aa022ec81b0871297]
@startuml Auth
Actor ユーザー
Participant Frontend as Front
Participant APIGateway as Gateway
Participant Lambda
Participant Cognito
Database Redis
Participant Backend as Back
Participant DB

ユーザー - -> Front: Action
Front - -> Gateway: Get: /users -header: {sessionId: SessionID}
Gateway - -> Lambda: Lambda Authorizer
Lambda - -> Redis: SessionIDを元にaccessToken取得
Redis - -> Lambda: accessToken
Lambda - -> Cognito: Token検証
note right
トークンの検証を行う
成功時、Backendのエンドポイントへのアクセスを許可する
end note
Cognito - -> Lambda: トークン検証結果
Lambda - -> Gateway: トークン検証結果返却
Gateway - -> Back: （成功時）Get: /users
Back - -> DB: ユーザー情報取得
DB - -> Back
Back - -> Back: ユーザーの権限情報を確認
note right
バックエンドでは、リクエストから権限情報を確認する
成功時、処理を実行し、レスポンスを返す
end note
Back - -> DB: リソース取得
DB - -> Back
Back - -> Gateway: Response"200":{"message": ok}
Gateway - -> Front: Response"200":{"message": ok}
@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.16+8
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>