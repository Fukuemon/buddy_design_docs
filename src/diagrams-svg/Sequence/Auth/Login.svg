<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="582px" preserveAspectRatio="none" style="width:837px;height:582px;" version="1.1" viewBox="0 0 837 582" width="837px" zoomAndPan="magnify"><defs><filter height="300%" id="f170puframvy5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f170puframvy5)" height="389.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="49" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f170puframvy5)" height="369.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f170puframvy5)" height="219.7344" style="stroke: #000000; stroke-width: 2.0;" width="812" x="13" y="258.9609"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="812" x="13" y="434.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="54" x2="54" y1="86.2969" y2="495.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="237.5" x2="237.5" y1="86.2969" y2="495.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="469" x2="469" y1="86.2969" y2="495.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="595.5" x2="595.5" y1="86.2969" y2="495.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="724" x2="724" y1="86.2969" y2="495.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="792" x2="792" y1="86.2969" y2="495.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="23" y="82.9951">ユーザー</text><ellipse cx="54" cy="13" fill="#FEFECE" filter="url(#f170puframvy5)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M54,21 L54,48 M41,29 L67,29 M54,48 L41,63 M54,48 L67,63 " fill="none" filter="url(#f170puframvy5)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="23" y="507.6904">ユーザー</text><ellipse cx="54" cy="520.9922" fill="#FEFECE" filter="url(#f170puframvy5)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M54,528.9922 L54,555.9922 M41,536.9922 L67,536.9922 M54,555.9922 L41,570.9922 M54,555.9922 L67,570.9922 " fill="none" filter="url(#f170puframvy5)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="197.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="204.5" y="70.9951">Frontend</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="197.5" y="494.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="204.5" y="514.6904">Frontend</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="420" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="427" y="70.9951">APIGateway</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="420" y="494.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="427" y="514.6904">APIGateway</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="556.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="563.5" y="70.9951">Backend</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="556.5" y="494.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="563.5" y="514.6904">Backend</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="688" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="695" y="70.9951">Cognito</text><rect fill="#FEFECE" filter="url(#f170puframvy5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="688" y="494.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="695" y="514.6904">Cognito</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="770" y="82.9951">Redis</text><path d="M774.5,34 C774.5,24 792.5,24 792.5,24 C792.5,24 810.5,24 810.5,34 L810.5,60 C810.5,70 792.5,70 792.5,70 C792.5,70 774.5,70 774.5,60 L774.5,34 " fill="#FEFECE" filter="url(#f170puframvy5)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M774.5,34 C774.5,44 792.5,44 792.5,44 C792.5,44 810.5,44 810.5,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="770" y="507.6904">Redis</text><path d="M774.5,520.9922 C774.5,510.9922 792.5,510.9922 792.5,510.9922 C792.5,510.9922 810.5,510.9922 810.5,520.9922 L810.5,546.9922 C810.5,556.9922 792.5,556.9922 792.5,556.9922 C792.5,556.9922 774.5,556.9922 774.5,546.9922 L774.5,520.9922 " fill="#FEFECE" filter="url(#f170puframvy5)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M774.5,520.9922 C774.5,530.9922 792.5,530.9922 792.5,530.9922 C792.5,530.9922 810.5,530.9922 810.5,520.9922 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f170puframvy5)" height="389.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="49" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f170puframvy5)" height="369.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="117.4297"/><polygon fill="#A80036" points="221,113.4297,231,117.4297,221,121.4297,225,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="227" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="66" y="112.3638">ユーザー情報入力</text><polygon fill="#A80036" points="457,142.5625,467,146.5625,457,150.5625,461,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="463" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="250" y="141.4966">Post：buddy.api.com/auth/login</text><path d="M160,159.5625 L160,184.5625 L460,184.5625 L460,169.5625 L450,159.5625 L160,159.5625 " fill="#FBFB77" filter="url(#f170puframvy5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M450,159.5625 L450,169.5625 L460,169.5625 L450,159.5625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="166" y="176.6294">-body: {username, password, facility_code}</text><polygon fill="#A80036" points="584,210.8281,594,214.8281,584,218.8281,588,214.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="469" x2="590" y1="214.8281" y2="214.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="476" y="209.7622">Post: /auth/login</text><polygon fill="#A80036" points="712,239.9609,722,243.9609,712,247.9609,716,243.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="596" x2="718" y1="243.9609" y2="243.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="603" y="238.895">ユーザー情報検証</text><path d="M13,258.9609 L77,258.9609 L77,265.9609 L67,275.9609 L13,275.9609 L13,258.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="219.7344" style="stroke: #000000; stroke-width: 2.0;" width="812" x="13" y="258.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="272.0278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="92" y="271.1714">[ログイン成功]</text><polygon fill="#A80036" points="607,293.2266,597,297.2266,607,301.2266,603,297.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="601" x2="723" y1="297.2266" y2="297.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="613" y="292.1606">トークン返却</text><polygon fill="#A80036" points="780.5,322.3594,790.5,326.3594,780.5,330.3594,784.5,326.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="596" x2="786.5" y1="326.3594" y2="326.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="603" y="321.2935">SessionID・トークン保存</text><polygon fill="#A80036" points="254,351.4922,244,355.4922,254,359.4922,250,355.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="595" y1="355.4922" y2="355.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="260" y="350.4263">SessionId返却</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="243" x2="285" y1="384.625" y2="384.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="285" x2="285" y1="384.625" y2="397.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="285" y1="397.625" y2="397.625"/><polygon fill="#A80036" points="254,393.625,244,397.625,254,401.625,250,397.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="250" y="379.5591">CookieにSessionIDを保存</text><polygon fill="#A80036" points="70,422.7578,60,426.7578,70,430.7578,66,426.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="232" y1="426.7578" y2="426.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="76" y="421.6919">/calendarへリダイレクト</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="825" y1="435.7578" y2="435.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="18" y="445.9683">[ロウイン失敗]</text><polygon fill="#A80036" points="70,466.6953,60,470.6953,70,474.6953,66,470.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="232" y1="470.6953" y2="470.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="76" y="465.6294">エラーメッセージを表示</text><!--MD5=[fc322954785bee3a73ce02033de9af88]
@startuml Login
Actor ユーザー
Participant Frontend as Front
Participant APIGateway as Gateway
Participant Backend as Back
Participant Cognito
Database Redis

activate ユーザー
ユーザー -> Front: ユーザー情報入力
activate Front
Front -> Gateway: Post：buddy.api.com/auth/login
note left of Gateway:  -body: {username, password, facility_code}
Gateway -> Back: Post: /auth/login
Back -> Cognito: ユーザー情報検証
alt ログイン成功
  Cognito - -> Back: トークン返却
  Back - -> Redis: SessionID・トークン保存
  Back - -> Front: SessionId返却
  Front - -> Front: CookieにSessionIDを保存
  Front - -> ユーザー: /calendarへリダイレクト
else ロウイン失敗
  Front - -> ユーザー: エラーメッセージを表示
end

deactivate ユーザー


@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.16+8
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>