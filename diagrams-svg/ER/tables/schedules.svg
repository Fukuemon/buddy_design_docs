<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="687px" preserveAspectRatio="none" style="width:1508px;height:687px;" version="1.1" viewBox="0 0 1508 687" width="1508px" zoomAndPan="magnify"><defs><filter height="300%" id="f3xsk6swhfpl9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[d793eab0308b02564d964ddad9e6e3f5]
cluster 予定--><polygon fill="#FFFFFF" filter="url(#f3xsk6swhfpl9)" points="22,24,56,24,63,46.2969,1214,46.2969,1214,675,22,675,22,24" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="63" y1="46.2969" y2="46.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="26" y="38.9951">予定</text><!--MD5=[af7553808e27414a6663019e1dd2c0e6]
cluster 職員情報--><polygon fill="#FFFFFF" filter="url(#f3xsk6swhfpl9)" points="1238,431,1300,431,1307,453.2969,1338,453.2969,1338,530,1238,530,1238,431" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1238" x2="1307" y1="453.2969" y2="453.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="1242" y="445.9951">職員情報</text><!--MD5=[d43a93bed96446588d3c5fef43396a6d]
cluster 訪問情報--><polygon fill="#FFFFFF" filter="url(#f3xsk6swhfpl9)" points="1362,431,1424,431,1431,453.2969,1486,453.2969,1486,530,1362,530,1362,431" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1362" x2="1431" y1="453.2969" y2="453.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="1366" y="445.9951">訪問情報</text><!--MD5=[974574cb1ae3b47966e90db496f42a34]
class schedules--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="201.6563" id="schedules" style="stroke: #A80036; stroke-width: 1.5;" width="390" x="808" y="159"/><ellipse cx="966.75" cy="175" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M970.8594,181 L963.1406,181 L963.1406,168.6094 L970.8594,168.6094 L970.8594,170.7656 L965.5938,170.7656 L965.5938,173.4375 L970.3594,173.4375 L970.3594,175.5938 L965.5938,175.5938 L965.5938,178.8438 L970.8594,178.8438 L970.8594,181 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="64" x="987.25" y="179.1543">schedules</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="809" x2="1197" y1="191" y2="191"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="259" x="814" y="205.2104">schedule_id : binary(16) «PK» "スケジュールID"</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="809" x2="1197" y1="211.8047" y2="211.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="227" x="814" y="226.0151">staff_id: binary(16) NOT_NULL "職員のID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="157" x="814" y="238.8198">title: string  "予定のタイトル"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="335" x="814" y="251.6245">schedule_type_id: binary(16) NOT_NULL «FK» "予定の種類ID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="312" x="814" y="264.4292">recurring_schedule_id: binary(16) «FK» "繰り返し予定ID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="231" x="814" y="277.2339">visit_info_id: binary(16) «FK» "訪問情報ID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="173" x="814" y="290.0386">description: string "予定の説明"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="288" x="814" y="302.8433">visit_date: date NOT_NULL "予定日（YYYY-MM-DD）"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="271" x="814" y="315.6479">start_time: time NOT_NULL "開始時間（HH:MM）"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="265" x="814" y="328.4526">end_time: time NOT_NULL "終了時間（HH:MM）"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="340" x="814" y="341.2573">schedule_cancel_id: binary(16)"キャンセル予定のid(NULL_OK)"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="378" x="814" y="354.062">is_overtime_work: boolean NOT_NULL "時間外勤務か(default=false)"</text><!--MD5=[5b96f930ea75387137104988349bd03f]
class schedule_types--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="73.6094" id="schedule_types" style="stroke: #A80036; stroke-width: 1.5;" width="202" x="557" y="453"/><ellipse cx="605.25" cy="469" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M609.3594,475 L601.6406,475 L601.6406,462.6094 L609.3594,462.6094 L609.3594,464.7656 L604.0938,464.7656 L604.0938,467.4375 L608.8594,467.4375 L608.8594,469.5938 L604.0938,469.5938 L604.0938,472.8438 L609.3594,472.8438 L609.3594,475 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="97" x="625.75" y="473.1543">schedule_types</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="558" x2="758" y1="485" y2="485"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="190" x="563" y="499.2104">schedule_type_id binary(16) «PK»</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="558" x2="758" y1="505.8047" y2="505.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="160" x="563" y="520.0151">name string "予定のタイプ名"</text><path d="M613.5,619 L613.5,659.2656 A0,0 0 0 0 613.5,659.2656 L702.5,659.2656 A0,0 0 0 0 702.5,659.2656 L702.5,629 L692.5,619 L662,619 L658,527.21 L654,619 L613.5,619 A0,0 0 0 0 613.5,619 " fill="#FBFB77" filter="url(#f3xsk6swhfpl9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M692.5,619 L692.5,629 L702.5,629 L692.5,619 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="619.5" y="636.0669">1: 通常業務</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="619.5" y="651.1997">3: 訪問</text><!--MD5=[4bac50278a7bf155671162b306843454]
class schedule_cancels--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="86.4141" id="schedule_cancels" style="stroke: #A80036; stroke-width: 1.5;" width="310" x="848" y="447"/><ellipse cx="943.25" cy="463" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M947.3594,469 L939.6406,469 L939.6406,456.6094 L947.3594,456.6094 L947.3594,458.7656 L942.0938,458.7656 L942.0938,461.4375 L946.8594,461.4375 L946.8594,463.5938 L942.0938,463.5938 L942.0938,466.8438 L947.3594,466.8438 L947.3594,469 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="963.75" y="467.1543">schedule_cancels</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="849" x2="1157" y1="479" y2="479"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="107" x="854" y="493.2104">id: binary(16) «PK»</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="849" x2="1157" y1="499.8047" y2="499.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="298" x="854" y="514.0151">schedule_id: binary(16) «FK» "キャンセルされた予定ID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="214" x="854" y="526.8198">cancel_reason: string "キャンセル理由"</text><!--MD5=[b9cd9f7342890dbd17bb89e9676ef692]
class recurring_rules--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="137.6328" id="recurring_rules" style="stroke: #A80036; stroke-width: 1.5;" width="414" x="100" y="421"/><ellipse cx="255.75" cy="437" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M259.8594,443 L252.1406,443 L252.1406,430.6094 L259.8594,430.6094 L259.8594,432.7656 L254.5938,432.7656 L254.5938,435.4375 L259.3594,435.4375 L259.3594,437.5938 L254.5938,437.5938 L254.5938,440.8438 L259.8594,440.8438 L259.8594,443 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="94" x="276.25" y="441.1543">recurring_rules</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="101" x2="513" y1="453" y2="453"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="256" x="106" y="467.2104">recurring_rule_id (16) «PK» "繰り返しルールID"</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="101" x2="513" y1="473.8047" y2="473.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="402" x="106" y="488.0151">frequency: int NOT_NULL "繰り返し頻度（monthly, weekly)をenumで扱う"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="130" x="106" y="500.8198">day_of_week: int "曜日"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="148" x="106" y="513.6245">day_of_month: int "月の日"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="157" x="106" y="526.4292">week_of_month: int "月の週"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="200" x="106" y="539.2339">start_date: date NOT_NULL "開始日"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="132" x="106" y="552.0386">end_date: date "終了日"</text><path d="M38,232.5 L38,287.8984 A0,0 0 0 0 38,287.8984 L246,287.8984 L250,420.74 L254,287.8984 L400,287.8984 A0,0 0 0 0 400,287.8984 L400,242.5 L390,232.5 L38,232.5 A0,0 0 0 0 38,232.5 " fill="#FBFB77" filter="url(#f3xsk6swhfpl9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M390,232.5 L390,242.5 L400,242.5 L390,232.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="44" y="249.5669">月, 週のいずれかで、日付 or 第何週目の曜日かを指定する</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="44" y="264.6997">月：day_of_month</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="44" y="279.8325">週：week_of_month, day_of_week</text><!--MD5=[797a6f84d7b864f3e98c7a18a9a69921]
class recurring_schedules--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="176.0469" id="recurring_schedules" style="stroke: #A80036; stroke-width: 1.5;" width="337" x="435.5" y="172"/><ellipse cx="536.25" cy="188" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M540.3594,194 L532.6406,194 L532.6406,181.6094 L540.3594,181.6094 L540.3594,183.7656 L535.0938,183.7656 L535.0938,186.4375 L539.8594,186.4375 L539.8594,188.5938 L535.0938,188.5938 L535.0938,191.8438 L540.3594,191.8438 L540.3594,194 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="127" x="556.75" y="192.1543">recurring_schedules</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="436.5" x2="771.5" y1="204" y2="204"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="284" x="441.5" y="218.2104">recurring_schedule_id: binary(16) «PK» NOT_NULL</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="436.5" x2="771.5" y1="224.8047" y2="224.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="325" x="441.5" y="239.0151">recurring_rule_id: binary(16) NOT_NULL "繰り返しルールID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="304" x="441.5" y="251.8198">schedule_type_id: binary(16) NOT_NULL "予定タイプID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="200" x="441.5" y="264.6245">visit_info_id: binary(16) "訪問情報ID"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="120" x="441.5" y="277.4292">title: string "タイトル"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="140" x="441.5" y="290.2339">description: string "説明"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="192" x="441.5" y="303.0386">visit_date: date NOT_NULL"訪問日"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="211" x="441.5" y="315.8433">start_time: time NOT_NULL "開始時間"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="205" x="441.5" y="328.6479">end_time: time NOT_NULL "終了時間"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="272" x="441.5" y="341.4526">recurring_exclusion_dates: json "除外日のリスト"</text><path d="M424.5,59 L424.5,99.2656 A0,0 0 0 0 424.5,99.2656 L600,99.2656 L604,171.95 L608,99.2656 L783.5,99.2656 A0,0 0 0 0 783.5,99.2656 L783.5,69 L773.5,59 L424.5,59 A0,0 0 0 0 424.5,59 " fill="#FBFB77" filter="url(#f3xsk6swhfpl9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M773.5,59 L773.5,69 L783.5,69 L773.5,59 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="430.5" y="76.0669">繰り返し予定の情報を保存する</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="430.5" y="91.1997">繰り返しタイプに基づいて、フロント側で予定を複製する</text><!--MD5=[8413f8248b2da7966d2de021109ec289]
class users--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="48" id="users" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="1254.5" y="466"/><ellipse cx="1269.5" cy="482" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1273.6094,488 L1265.8906,488 L1265.8906,475.6094 L1273.6094,475.6094 L1273.6094,477.7656 L1268.3438,477.7656 L1268.3438,480.4375 L1273.1094,480.4375 L1273.1094,482.5938 L1268.3438,482.5938 L1268.3438,485.8438 L1273.6094,485.8438 L1273.6094,488 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="35" x="1283.5" y="486.1543">users</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1255.5" x2="1320.5" y1="498" y2="498"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1255.5" x2="1320.5" y1="506" y2="506"/><!--MD5=[8d41beee1a3a43cb45bc7f02531b65aa]
class visit_infos--><rect fill="#FEFECE" filter="url(#f3xsk6swhfpl9)" height="48" id="visit_infos" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1378" y="466"/><ellipse cx="1393" cy="482" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1397.1094,488 L1389.3906,488 L1389.3906,475.6094 L1397.1094,475.6094 L1397.1094,477.7656 L1391.8438,477.7656 L1391.8438,480.4375 L1396.6094,480.4375 L1396.6094,482.5938 L1391.8438,482.5938 L1391.8438,485.8438 L1397.1094,485.8438 L1397.1094,488 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="60" x="1407" y="486.1543">visit_infos</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1379" x2="1469" y1="498" y2="498"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1379" x2="1469" y1="506" y2="506"/><!--MD5=[71fc5a0492f46b52026836a03787d46e]
link schedules to users--><path d="M1178,369.22 C1178,369.22 1178,490 1178,490 C1178,490 1246.4,490 1246.4,490 " fill="none" id="schedules-users" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.4" x2="1250.4" y1="486" y2="494"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247.4" x2="1247.4" y1="486" y2="494"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246.4" x2="1254.4" y1="490" y2="490"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1178" x2="1172" y1="369.22" y2="361.22"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1178" x2="1184" y1="369.22" y2="361.22"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1178" x2="1178" y1="369.22" y2="361.22"/><ellipse cx="1178" cy="375.22" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b0315b6d207f5307ce08ac02c7950f10]
link schedules to schedule_types--><path d="M828,369.22 C828,369.22 828,490 828,490 C828,490 767.34,490 767.34,490 " fill="none" id="schedules-schedule_types" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.34" x2="763.34" y1="494" y2="486"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="766.34" x2="766.34" y1="494" y2="486"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="767.34" x2="759.34" y1="490" y2="490"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="828" x2="822" y1="369.22" y2="361.22"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="828" x2="834" y1="369.22" y2="361.22"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="828" x2="828" y1="369.22" y2="361.22"/><ellipse cx="828" cy="375.22" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[3fe5e276e884d9aeaf58fc38bc296c59]
link schedules to schedule_cancels--><path d="M1003,369.22 C1003,369.22 1003,438.72 1003,438.72 " fill="none" id="schedules-schedule_cancels" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1003" x2="1003" y1="435.72" y2="446.72"/><ellipse cx="1003" cy="435.72" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1007" x2="999" y1="442.72" y2="442.72"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="999" x2="1007" y1="365.22" y2="365.22"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="999" x2="1007" y1="368.22" y2="368.22"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1003" x2="1003" y1="369.22" y2="361.22"/><!--MD5=[5b341626f80826ad54f570b4464b5a56]
link schedules to visit_infos--><path d="M1206.19,260 C1206.19,260 1439.33,260 1439.33,260 C1439.33,260 1439.33,457.82 1439.33,457.82 " fill="none" id="schedules-visit_infos" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.33" x2="1439.33" y1="454.82" y2="465.82"/><ellipse cx="1439.33" cy="454.82" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443.33" x2="1435.33" y1="461.82" y2="461.82"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1202.19" x2="1202.19" y1="264" y2="256"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1205.19" x2="1205.19" y1="264" y2="256"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206.19" x2="1198.19" y1="260" y2="260"/><!--MD5=[bc640e885b0500b90846d648ec4e4061]
link recurring_schedules to users--><path d="M763.5,356.1 C763.5,356.1 763.5,401 763.5,401 C763.5,401 1288,401 1288,401 C1288,401 1288,457.68 1288,457.68 " fill="none" id="recurring_schedules-users" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1292" x2="1284" y1="461.68" y2="461.68"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1292" x2="1284" y1="458.68" y2="458.68"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1288" x2="1288" y1="457.68" y2="465.68"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="757.5" y1="356.1" y2="348.1"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="769.5" y1="356.1" y2="348.1"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="763.5" y1="356.1" y2="348.1"/><ellipse cx="763.5" cy="362.1" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[7c2d68adb9c147a35a89dba2afc00f0a]
link recurring_schedules to schedule_types--><path d="M658,356.27 C658,356.27 658,444.71 658,444.71 " fill="none" id="recurring_schedules-schedule_types" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="662" x2="654" y1="448.71" y2="448.71"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="662" x2="654" y1="445.71" y2="445.71"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658" x2="658" y1="444.71" y2="452.71"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658" x2="652" y1="356.27" y2="348.27"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658" x2="664" y1="356.27" y2="348.27"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658" x2="658" y1="356.27" y2="348.27"/><ellipse cx="658" cy="362.27" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f242e27a6ff7d0d6ad443347d3c0e96e]
link recurring_schedules to recurring_rules--><path d="M474.75,355.27 C474.75,355.27 474.75,413.89 474.75,413.89 " fill="none" id="recurring_schedules-recurring_rules" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="478.75" x2="470.75" y1="416.89" y2="416.89"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="478.75" x2="470.75" y1="413.89" y2="413.89"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="474.75" x2="474.75" y1="412.89" y2="420.89"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="470.75" x2="478.75" y1="352.27" y2="352.27"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="470.75" x2="478.75" y1="355.27" y2="355.27"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="474.75" x2="474.75" y1="356.27" y2="348.27"/><!--MD5=[f7f397b51a8c105ad9019a9ac01ddb07]
link recurring_schedules to visit_infos--><path d="M768,355.26 C768,355.26 768,381 768,381 C768,381 1408.67,381 1408.67,381 C1408.67,381 1408.67,458.81 1408.67,458.81 " fill="none" id="recurring_schedules-visit_infos" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.67" x2="1404.67" y1="461.81" y2="461.81"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.67" x2="1404.67" y1="458.81" y2="458.81"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1408.67" x2="1408.67" y1="457.81" y2="465.81"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="764" x2="772" y1="352.26" y2="352.26"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="764" x2="772" y1="355.26" y2="355.26"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768" x2="768" y1="356.26" y2="348.26"/><!--MD5=[4d9a59c518f89022b89f83d3e7078ddd]
@startuml entity-relationship-diagram
skinparam linetype ortho

package 予定 {
  entity schedules {
    schedule_id : binary(16) <<PK>> "スケジュールID"
    - -
    staff_id: binary(16) NOT_NULL "職員のID"
    title: string  "予定のタイトル"
    schedule_type_id: binary(16) NOT_NULL <<FK>> "予定の種類ID"
    recurring_schedule_id: binary(16) <<FK>> "繰り返し予定ID"
    visit_info_id: binary(16) <<FK>> "訪問情報ID"
    description: string "予定の説明"
    visit_date: date NOT_NULL "予定日（YYYY-MM-DD）"
    start_time: time NOT_NULL "開始時間（HH:MM）"
    end_time: time NOT_NULL "終了時間（HH:MM）"
    schedule_cancel_id: binary(16)"キャンセル予定のid(NULL_OK)"
    is_overtime_work: boolean NOT_NULL "時間外勤務か(default=false)"
  }

  entity schedule_types {
    schedule_type_id binary(16) <<PK>>
    - -
    name string "予定のタイプ名"
  }

  note bottom of schedule_types
    1: 通常業務
    3: 訪問
  end note

  entity schedule_cancels {
    id: binary(16) <<PK>>
    - -
    schedule_id: binary(16) <<FK>> "キャンセルされた予定ID"
    cancel_reason: string "キャンセル理由"
  }

  entity recurring_rules {
    recurring_rule_id (16) <<PK>> "繰り返しルールID"
    - -
    frequency: int NOT_NULL "繰り返し頻度（monthly, weekly)をenumで扱う"
    day_of_week: int "曜日"
    day_of_month: int "月の日"
    week_of_month: int "月の週"
    start_date: date NOT_NULL "開始日"
    end_date: date "終了日"
  }
  note top of recurring_rules
  月, 週のいずれかで、日付 or 第何週目の曜日かを指定する
  月：day_of_month
  週：week_of_month, day_of_week
  end note

  entity recurring_schedules {
    recurring_schedule_id: binary(16) <<PK>> NOT_NULL
    - -
    recurring_rule_id: binary(16) NOT_NULL "繰り返しルールID"
    schedule_type_id: binary(16) NOT_NULL "予定タイプID"
    visit_info_id: binary(16) "訪問情報ID"
    title: string "タイトル"
    description: string "説明"
    visit_date: date NOT_NULL"訪問日"
    start_time: time NOT_NULL "開始時間"
    end_time: time NOT_NULL "終了時間"
    recurring_exclusion_dates: json "除外日のリスト"
  }
  note top of recurring_schedules
    繰り返し予定の情報を保存する
    繰り返しタイプに基づいて、フロント側で予定を複製する
  end note
}


package 職員情報 {
  entity users {
  }
}

package 訪問情報 {
  entity visit_infos {
  }

}

schedules }o- -|| users
schedules }o- -|| schedule_types
schedules ||- -o| schedule_cancels
schedules ||- -o| visit_infos
recurring_schedules }o- -|| users
recurring_schedules }o- -|| schedule_types
recurring_schedules ||- -|| recurring_rules
recurring_schedules ||- -|| visit_infos

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.16+8
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>